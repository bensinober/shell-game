<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MACHINE VS MAN</title>
    <link href="https://fonts.cdnfonts.com/css/blade-runner-movie-font" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">
    <link href="assets/style.css" rel="stylesheet">
    <!--<link rel="shortcut icon" href="teachable-machine.jpg" type="image/x-icon" />-->
</head>

<body>
    <div id="title">undroid shell game</div>
    <div id="dividedbox">
      <div class="quarter" id="NW">
        <div class="scores">
          <div class="col">maskin:</div><div class="col" id="machineScore">15</div>
          <div class="col">menneske:</div><div class="col" id="humanScore">45</div>
        </div>
      </div>
      <div class="quarter" id="NE">
        <canvas id="slideBox" width="950" height="450"></canvas>
      </div>
      <div class="quarter" id="SE">
        <div id="gameMode"></div>
        <div class="centroid">150,150</div>
        <div class="buttons">
          <button id="startBtn" class="arcade-button open">Start</button>
          <button id="predictBtn" class="arcade-button">Gjett</button>
          <button id="verdictBtn" class="arcade-button">Vis</button>
          <!--<button id="eyesBtn" class="arcade-button">Ã˜yne</button>-->
        </div>
        <button id="connectBtn" class="arcade-button">Koble</button>
      </div>
      <div class="quarter" id="SW">
        <canvas id="predictBox" width="900" height="450"></canvas>
      </div>
    <div id="fullscreenOverlay" class="overlay hidden">
      <img id="overlayImg" width="300" height="400" />
      <div class="countdownTimer"></div>
      <div id="overlayText"></div>
    </div>
  </div>
  <script type="module" id="main">

    import { writeToEyes, connectToEyes, clearData, sendGameMode, buttonLedOn, hideOverlay } from "./assets/script.js"

    document.addEventListener("DOMContentLoaded", function() {

      // simple countdown timer
      document.getElementById("startBtn").addEventListener("click", function(evt) {
        document.getElementById("startBtn").classList.remove("open")
        showOverlay("snurr i vei!")
        clearData()
        duration = 18 // one game = 18 secs
        slideCnt = 0
        timerId = setInterval(function (evt) {
          if(duration <= 0) {
            // FINISHED
            clearInterval(timerId)
            document.querySelector(".countdownTimer").innerHTML = "FERDIG!"
            setTimeout(() => {
              document.querySelector(".countdownTimer").innerHTML = ""
            }, 1000)
            sendGameMode(2) // GameMode.STOP
            buttonLedOn(startBtn)
            document.getElementById("predictBtn").classList.add("open")
            hideOverlay()
          } else {
            document.querySelector(".countdownTimer").innerHTML = "00:" + duration.toString().padStart(2, "0")
            sendGameMode(3) // GameMode.SNAP
            if (duration < 4) {
              let mySound = new Audio("assets/beep-09.wav")
              mySound.play()
            }
          }
          duration -= 1
          slideCnt += 1
        }, 1000)
      })

      //document.getElementById("eyesBtn").addEventListener("click", function(evt) {
      //  console.log("EYES")
      //  popUpOverlay("my eyes see you!")
      //})
      document.getElementById("predictBtn").addEventListener("click", function(evt) {
        console.log("PREDICT")
        sendGameMode(7) // GameMode.PREDICT
        document.getElementById("predictBtn").classList.remove("open")
        document.getElementById("verdictBtn").classList.add("open")
      })

      document.getElementById("verdictBtn").addEventListener("click", function(evt) {
        console.log("VERDICT")
        sendGameMode(8) // GameMode.VERDICT
        document.getElementById("verdictBtn").classList.remove("open")
        document.getElementById("startBtn").classList.add("open")
      })

      document.getElementById("connectBtn").addEventListener("click", async(evt) => {
        if ("bluetooth" in navigator) {
          try {
            await connectToEyes()
          } catch(err) {
            console.log(err)
          }
        } else {
          console.log("you need to activate web bluetooth api in browser!")
        }
      })

    })
  </script>
</body>

</html>

